/*!
 * Compressor.js v1.1.1
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2022-10-13T13:09:08.771Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Compressor=t()}(this,function(){"use strict";function t(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function a(i){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?t(Object(a),!0).forEach(function(e){var t,r;t=i,e=a[r=e],r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(a,e))})}return i}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}var e,r,o,l,c,h,u,f,i={exports:{}};e=i,"undefined"!=typeof window&&(o=(r=window).HTMLCanvasElement&&r.HTMLCanvasElement.prototype,l=r.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),c=l&&r.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),h=r.BlobBuilder||r.WebKitBlobBuilder||r.MozBlobBuilder||r.MSBlobBuilder,u=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,f=(l||h)&&r.atob&&r.ArrayBuffer&&r.Uint8Array&&function(e){var t,r,i,a,n,o=e.match(u);if(!o)throw new Error("invalid data URI");for(t=o[2]?o[1]:"text/plain"+(o[3]||";charset=US-ASCII"),i=!!o[4],o=e.slice(o[0].length),r=(i?atob:decodeURIComponent)(o),i=new ArrayBuffer(r.length),a=new Uint8Array(i),n=0;n<r.length;n+=1)a[n]=r.charCodeAt(n);return l?new Blob([c?a:i],{type:t}):((o=new h).append(i),o.getBlob(t))},r.HTMLCanvasElement&&!o.toBlob&&(o.mozGetAsFile?o.toBlob=function(e,t,r){var i=this;setTimeout(function(){r&&o.toDataURL&&f?e(f(i.toDataURL(t,r))):e(i.mozGetAsFile("blob",t))})}:o.toDataURL&&f&&(o.msToBlob?o.toBlob=function(e,t,r){var i=this;setTimeout(function(){(t&&"image/png"!==t||r)&&o.toDataURL&&f?e(f(i.toDataURL(t,r))):e(i.msToBlob(t))})}:o.toBlob=function(e,t,r){var i=this;setTimeout(function(){e(f(i.toDataURL(t,r)))})})),e.exports?e.exports=f:r.dataURLtoBlob=f);function j(e){return 0<e&&e<1/0}var T=i.exports,d={strict:!0,checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,retainExif:!1,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},p="undefined"!=typeof window&&void 0!==window.document?window:{},g=Array.prototype.slice;var m=/^image\/.+$/;function x(e){return m.test(e)}var b=String.fromCharCode;var y=p.btoa;function R(e,t){for(var r,i=[],a=new Uint8Array(e);0<a.length;)i.push(b.apply(null,(r=a.subarray(0,8192),Array.from?Array.from(r):g.call(r)))),a=a.subarray(8192);return"data:".concat(t,";base64,").concat(y(i.join("")))}function w(e){var t,r,i,a,n,o,l,s=new DataView(e);try{if(255===s.getUint8(0)&&216===s.getUint8(1))for(var c=s.byteLength,h=2;h+1<c;){if(255===s.getUint8(h)&&225===s.getUint8(h+1)){r=h;break}h+=1}if(r&&(a=r+10,"Exif"===function(e,t,r){var i,a="";for(r+=t,i=t;i<r;i+=1)a+=b(e.getUint8(i));return a}(s,r+4,4)&&(!(l=18761===(n=s.getUint16(a)))&&19789!==n||42!==s.getUint16(a+2,l)||8<=(o=s.getUint32(a+4,l))&&(i=a+o))),i)for(var u,f=s.getUint16(i,l),d=0;d<f;d+=1)if(u=i+12*d+2,274===s.getUint16(u,l)){u+=8,t=s.getUint16(u,l),s.setUint16(u,1,l);break}}catch(e){t=1}return t}var v=/\.\d*(?:0|9){12}\d*$/;function k(e,t){t=1<arguments.length&&void 0!==t?t:1e11;return v.test(e)?Math.round(e*t)/t:e}function D(e,t){var r=e.aspectRatio,i=e.height,a=e.width,n=1<arguments.length&&void 0!==t?t:"none",o=j(a),e=j(i);return o&&e?(t=i*r,("contain"===n||"none"===n)&&a<t||"cover"===n&&t<a?i=a/r:a=i*r):o?i=a/r:e&&(a=i*r),{width:a,height:i}}var U=p.ArrayBuffer,B=p.FileReader,O=p.URL||p.webkitURL,A=/\.\w+$/,E=p.Compressor;return function(){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.file=e,this.image=new Image,this.options=a(a({},d),t),this.exif=[],this.aborted=!1,this.result=null,this.init()}var e,t,i;return e=r,i=[{key:"noConflict",value:function(){return window.Compressor=E,r}},{key:"setDefaults",value:function(e){s(d,e)}}],(t=[{key:"init",value:function(){var i,e,a,n=this,o=this.file,l=this.options;e=o,"undefined"!=typeof Blob&&(e instanceof Blob||"[object Blob]"===Object.prototype.toString.call(e))?x(i=o.type)?O&&B?(U||(l.checkOrientation=!1),O&&!l.checkOrientation?this.load({url:O.createObjectURL(o)}):(e=new B,a=l.checkOrientation&&"image/jpeg"===i,(this.reader=e).onload=function(e){var t=e.target.result,r={};l.retainExif&&(n.exif=function(e){for(var t,r,i=0,a=[],n=[].slice.call(new Uint8Array(e),0);;){if(255===n[i]&&218===n[i+1])break;if(255===n[i]&&216===n[i+1]?i+=2:(r=256*n[i+2]+n[i+3],r=n.slice(i,t=i+r+2),i=t,a.push(r)),i>n.length)break}if(!a.length)return[];for(var o=[],l=0;l<a.length;l+=1){var s=a[l];255===s[0]&&225===s[1]&&(o=o.concat(s))}return o}(t)),a?1<(e=w(t))||!O?(r.url=R(t,i),1<e&&s(r,function(e){var t=0,r=1,i=1;switch(e){case 2:r=-1;break;case 3:t=-180;break;case 4:i=-1;break;case 5:t=90,i=-1;break;case 6:t=90;break;case 7:t=90,r=-1;break;case 8:t=-90}return{rotate:t,scaleX:r,scaleY:i}}(e))):r.url=O.createObjectURL(o):r.url=t,n.load(r)},e.onabort=function(){n.fail(new Error("Aborted to read the image with FileReader."))},e.onerror=function(){n.fail(new Error("Failed to read the image with FileReader."))},e.onloadend=function(){n.reader=null},a?e.readAsArrayBuffer(o):e.readAsDataURL(o))):this.fail(new Error("The current browser does not support image compression.")):this.fail(new Error("The first argument must be an image File or Blob object.")):this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(e){var t=this,r=this.file,i=this.image;i.onload=function(){t.draw(a(a({},e),{},{naturalWidth:i.naturalWidth,naturalHeight:i.naturalHeight}))},i.onabort=function(){t.fail(new Error("Aborted to load the image."))},i.onerror=function(){t.fail(new Error("Failed to load the image."))},p.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(p.navigator.userAgent)&&(i.crossOrigin="anonymous"),i.alt=r.name,i.src=e.url}},{key:"draw",value:function(e){var a=this,n=e.naturalWidth,o=e.naturalHeight,t=e.rotate,r=void 0===t?0:t,i=e.scaleX,l=void 0===i?1:i,s=e.scaleY,c=void 0===s?1:s,h=this.file,u=this.image,f=this.options,d=document.createElement("canvas"),p=d.getContext("2d"),g=Math.abs(r)%180==90,m=("contain"===f.resize||"cover"===f.resize)&&j(f.width)&&j(f.height),b=Math.max(f.maxWidth,0)||1/0,y=Math.max(f.maxHeight,0)||1/0,w=Math.max(f.minWidth,0)||0,t=Math.max(f.minHeight,0)||0,i=n/o,e=f.width,s=f.height;g&&(b=(v=[y,b])[0],y=v[1],w=(v=[t,w])[0],t=v[1],e=(v=[s,e])[0],s=v[1]);var v=D({aspectRatio:i=m?e/s:i,width:b,height:y},"contain");b=v.width,y=v.height;v=D({aspectRatio:i,width:w,height:t},"cover");w=v.width,t=v.height,s=m?(e=(v=D({aspectRatio:i,width:e,height:s},f.resize)).width,v.height):(e=void 0===(B=(U=D({aspectRatio:i,width:e,height:s})).width)?n:B,void 0===(B=U.height)?o:B);var U=-(e=Math.floor(k(Math.min(Math.max(e,w),b))))/2,B=-(s=Math.floor(k(Math.min(Math.max(s,t),y))))/2,w=e,b=s,t=[];m&&(y=(i=D({aspectRatio:i,width:y=n,height:m=o},{contain:"cover",cover:"contain"}[f.resize])).width,m=i.height,t.push((n-y)/2,(o-m)/2,y,m)),t.push(U,B,w,b),g&&(e=(A=[s,e])[0],s=A[1]),d.width=e,d.height=s,x(f.mimeType)||(f.mimeType=h.type);var O,A="transparent";h.size>f.convertSize&&0<=f.convertTypes.indexOf(f.mimeType)&&(f.mimeType="image/jpeg"),"image/jpeg"===f.mimeType&&(A="#fff"),p.fillStyle=A,p.fillRect(0,0,e,s),f.beforeDraw&&f.beforeDraw.call(this,p,d),this.aborted||(p.save(),p.translate(e/2,s/2),p.rotate(r*Math.PI/180),p.scale(l,c),p.drawImage.apply(p,[u].concat(t)),p.restore(),f.drew&&f.drew.call(this,p,d),this.aborted||(O=this,p=function(e){var t,r,i;a.aborted||(f.retainExif&&e?(t=e,r=function(e){var t,r;O.done({naturalWidth:n,naturalHeight:o,result:function(e,t){for(var t=(1<arguments.length&&void 0!==t?t:null)||e.split(",")[0].split(":")[1].split(";")[0],r=atob(e.split(",")[1]),e=new ArrayBuffer(r.length),i=new Uint8Array(e),a=0;a<r.length;a+=1)i[a]=r.charCodeAt(a);return new Blob([i],{type:t})}(R((t=function(e){e=e.replace(/^data:([^;]+);base64,/gim,"");for(var t=atob(e),r=t.length,e=new ArrayBuffer(r),i=new Uint8Array(e),a=0;a<r;a+=1)i[a]=t.charCodeAt(a);return e}(e,f.mimeType),r=O.exif,255!==(e=[].slice.call(new Uint8Array(t),0))[2]||224!==e[3]?t:(t=256*e[4]+e[5],t=[255,216].concat(r,e.slice(4+t)),new Uint8Array(t))),f.mimeType))},O)},(i=new FileReader).onloadend=function(){r(i.result)},i.readAsDataURL(t)):a.done({naturalWidth:n,naturalHeight:o,result:e}))},d.toBlob?d.toBlob(p,f.mimeType,f.quality):p(T(d.toDataURL(f.mimeType,f.quality)))))}},{key:"done",value:function(e){var t=e.naturalWidth,r=e.naturalHeight,i=e.result,a=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)||this,n=a.file,e=a.image,a=a.options;O&&!a.checkOrientation&&O.revokeObjectURL(e.src),!i||a.strict&&i.size>n.size&&a.mimeType===n.type&&!(a.width>t||a.height>r||a.minWidth>t||a.minHeight>r||a.maxWidth<t||a.maxHeight<r)?i=n:(r=new Date,i.lastModified=r.getTime(),i.lastModifiedDate=r,i.name=n.name,i.name&&i.type!==n.type&&(i.name=i.name.replace(A,(n=x(n=i.type)?n.substr(6):"",".".concat(n="jpeg"===n?"jpg":n))))),this.result=i,a.success&&a.success.call(this,i)}},{key:"fail",value:function(e){var t=this.options;if(!t.error)throw e;t.error.call(this,e)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}])&&n(e.prototype,t),i&&n(e,i),r}()});